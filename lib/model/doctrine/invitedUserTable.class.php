<?php

/**
 * invitedUserTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class invitedUserTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object invitedUserTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('invitedUser');
    }

    public function getQueryForAdmin(Doctrine_Query $q)
    {
        $rootAlias = $q->getRootAlias();

        $q->addGroupBy($rootAlias . '.user_id');

        return $q;
    }

    
    public function getQueryForInvitedUserTable(Doctrine_Query $q)
    {
    	$rootAlias = $q->getRootAlias();
    
    	$q->innerJoin($rootAlias . '.UserProfile up')
    	->addWhere('up.country_id =?',  getlokalPartner::getInstance())
    	->addGroupBy($rootAlias . '.user_id');
    	return $q;
    }
    
    static public function applyEmailFilter($query, $value)
    {
        $rootAlias = $query->getRootAlias();

        //$query->addWhere($rootAlias . '.email like ?', $value['text'].'%');
        $query->innerJoin($rootAlias.'.UserProfile ua12v')
            ->innerJoin('ua12v.sfGuardUser sfg2')
            ->addWhere('sfg2.email_address like ?', $value['text'].'%');	

        return $query;
    }

    static public function applyFacebookFilter($query, $value)
    {
        $rootAlias = $query->getRootAlias();

        //$query->addWhere($rootAlias . '.facebook_uid like ?', $value['text'].'%');	
        $query->innerJoin($rootAlias.'.UserProfile fv23')
            ->addWhere('fv23.facebook_uid like ?', $value['text'].'%');	

        return $query;
    }

    static public function applyFirstNameFilter($query, $value)
    {
        $rootAlias = $query->getRootAlias();

        $query->innerJoin($rootAlias.'.UserProfile ua12')
            ->innerJoin('ua12.sfGuardUser ss22')
            ->addWhere('ss22.first_name like ?', $value['text'].'%');	

        return $query;
    }

    static public function applyLastNameFilter($query, $value)
    {
        $rootAlias = $query->getRootAlias();

        $query->innerJoin($rootAlias.'.UserProfile l13')
            ->innerJoin('l13.sfGuardUser sg3d')
            ->addWhere('sg3d.last_name like ?', $value['text'].'%');	

        return $query;
    }

    static public function applyCityFilter($query, $value)
    {
        $rootAlias = $query->getRootAlias();

        $query->innerJoin($rootAlias.'.UserProfile bp')
            ->innerJoin('bp.City ccf')
            ->addWhere('ccf.id  = ?', $value);	

        return $query;
    }
}