<?php

/**
 * ArticleImage
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    getLokal
 * @subpackage model
 * @author     Get Lokal
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class ArticleImage extends BaseArticleImage
{
	public function __toString() {
		return $this->getFilename();
	}

	public function save(Doctrine_Connection $con = null) {
		$this->setDescrption(strip_tags($this->getDescrption()));
		$this->setSource(strip_tags($this->getSource()));
		$modified=$this->getModified();
		//var_dump($modified); exit();
		if (isset($modified['filename']) && strlen($this->getFilename())) { //echo 'bq';
			$code = '{/'.substr ( uniqid (  md5 ($this->getFilename()), true ), 0, 8 ).'/}';
			$this->setCode($code);
			ZestCMSImages::createImageThumbnails('article', $this->getFilename());
			return parent::save();
		} elseif ( !$this->isNew() && (isset($modified['source']) || isset($modified['descrption']) || isset($modified['rank'])) ){
			return parent::save();
		}
		 else {
			return -1;
		}
	}

	
	public function delete(Doctrine_Connection $con = null) {
		if (strlen($this->getFilename())) {
			ZestCMSImages::deleteImageThumbnails('article', $this->getFilename());
		}
		@unlink($this->getImagePath('original'));
	
		return parent::delete($con);
	}
	
	public function getImageURL($size = 'original') {
		if ($this->getFilename()) {
			return ZestCMSImages::getImageURL('article', $size) . $this->getFilename();
		}
	}
	
	public function getImagePath($size = 'original') {
		if ($this->getFilename()) {
			return ZestCMSImages::getImagePath('article', $size) . $this->getFilename();
		}
	}
	
}