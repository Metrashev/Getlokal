<?php

/**
 * CategoryArticle
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    getLokal
 * @subpackage model
 * @author     Get Lokal
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class CategoryArticle extends BaseCategoryArticle
{
	public function getTitleByCulture($culture) {
		if ($this->Translation[$culture]->_get('title', $culture))
			return $this->Translation[$culture]->_get('title', $culture);
		else return false;
	}
	public static function getPagerOfCategoriesForArticleSearchByTitle($categoryName, $page = 1, $articleId, $row = 10, $culture = null){
	
		if (empty($culture)){
			$culture = sfContext::getInstance()->getUser()->getCulture();
		}
		$categoryName = mb_convert_case($categoryName, MB_CASE_TITLE, "UTF-8");
	
		$categoryName= "%" . $categoryName . "%";
		$query = Doctrine::getTable('CategoryArticle')
		->createQuery('c')
		->innerJoin('c.Translation ct with ct.lang=?', $culture)
		->where ( '(ct.title LIKE ?) ', array ($categoryName) )
		->orderBy('c.created_at DESC')
		->limit(10);
	
		$q2 = $query->createSubquery ()->select ( 'ac.category_id' )
		->from ( 'ArticleCategory ac' )
		->andWhere('ac.article_id = ?', $articleId);
	
		$query->andWhere ( 'c.id NOT IN (' . $q2->getDql () . ')' );
	
		$pages = $query->execute();
		/*
		 $pager = new sfDoctrinePager ( 'Page', $row );
	
		$pager->setQuery($query);
	
	
		$pager->setPage ( $page );
		$pager->init ();
		*/
		return $pages;
	}
}