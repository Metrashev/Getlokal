<?php

/**
 * Notification
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    getLokal
 * @subpackage model
 * @author     Get Lokal
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Notification extends BaseNotification
{
   protected $model;
   
   
public function setModel()
  {
    switch ($this->getModelName())
    {
      case 'Message':
        $msg = Doctrine::getTable('Message')->findOneById($this->getForeignId());
        $this->model = empty($msg) ? new Message : $msg;
        break;
      case 'Page':
        $foolower = Doctrine::getTable('Page')->findOneById($this->getForeignId());
        $this->model = empty($foolower) ? new Page : $foolower; 
        break;
      case 'Badge':
        $winner = Doctrine::getTable('Badge')->findOneById($this->getForeignId());
        $this->model = empty($winner) ? new Badge : $winner;  
        break;    
    }
  }
  
 public function getModel()
  {
    return $this->model;
  }
  
public function read()
  {
    $this->setIsRead(true);
    $this->save();
  }

  
public function notifyMessage(Message $msg)
  {
    $this->setPageId($msg->getPageTo());
    $this->setModelName('Message');
    $this->setForeignId($msg->getId());
    $this->save();
  }
  
public function notifyFollowPage(FollowPage $follow)
  {
    $this->setPageId($follow->getPageId());
    $this->setModelName('Page');
    $this->setForeignId($follow->getUserProfile()->getUserPage()->getId());
    $this->save();
  }
public function notifyBadge(UserBadge $badge)
  {
    $this->setPageId($badge->getUserProfile()->getUserPage()->getId());
    $this->setModelName('Badge');
    $this->setForeignId($badge->getBadgeId());
    $this->save();
  }
  
 public function getObj()
  {
   
   if (!$this->getIsRead()){
   $this->read();
   }
   $this->setModel();
   return  $this->model;
     
  }
}