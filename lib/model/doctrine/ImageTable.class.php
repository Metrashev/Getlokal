<?php

/**
 * ImageTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ImageTable extends Doctrine_Table
{
  /**
     * Returns an instance of this class.
     *
     * @return object ImageTable
     */
  public static function getInstance()
  {
      return Doctrine_Core::getTable('Image');
  }
  
  public function getQueryForAdmin(Doctrine_Query $q)
  {
    $rootAlias = $q->getRootAlias();

    $q->innerJoin($rootAlias . '.UserProfile p')
      ->leftJoin($rootAlias.'.CompanyImage ci')
      ->leftJoin($rootAlias.'.Profile')
      ->leftJoin('p.sfGuardUser sf')
      ->leftJoin('ci.Company c')
      ->where('c.country_id = ?', sfContext::getInstance()->getUser()->getCountry()->getId());

    return $q;
  }
  /*
static public function applyEmailAddressFilter($query, $value)
  {
    $rootAlias = $query->getRootAlias();
    $query->innerJoin($rootAlias.'.UserProfile f1')
            ->innerJoin('f1.sfGuardUser sf1')
            ->addWhere('sf1.email_address like ? ', $value['text'].'%');	

    return $query;
    
  }
  
static public function applyFirstNameFilter($query, $value)
  {
    $rootAlias = $query->getRootAlias();
    $query->innerJoin($rootAlias.'.UserProfile u2')
            ->innerJoin('u2.sfGuardUser s2')
            ->addWhere('s2.first_name like ?', $value['text'].'%');	

    return $query;
       
      
   
  }
  
static public function applyLastNameFilter($query, $value)
  {
  	
    $rootAlias = $query->getRootAlias();
    $query->innerJoin($rootAlias.'.UserProfile l3')
            ->innerJoin('l3.sfGuardUser sg3')
            ->addWhere('sg3.last_name like ?', $value['text'].'%');	

    return $query;
       
      
   
  }
static public function applyCompanyCityFilter($query, $value)
  {
    $rootAlias = $query->getRootAlias();
      $query->innerJoin($rootAlias.'.CompanyImage ci4')
      ->innerJoin('ci4.Company c4')
      ->addWhere('c4.city_id = ?',  $value);
      
      return $query;
   
  }
static public function applyCompanyFilter($query, $value)
  {
  
     $rootAlias = $query->getRootAlias();
    
     $query->innerJoin($rootAlias.'.CompanyImage ci5')
      ->innerJoin('ci5.Company c5')
      ->addWhere('c5.title like ? or c5.title_en like ?', array( '%'.$value['text'].'%',  '%'.$value['text'].'%'));
      
    return $query;
  
  }
  static public function applyCompanyStatusFilter($query, $value)
  {
    $rootAlias = $query->getRootAlias();
      $query->innerJoin($rootAlias.'.CompanyImage ci3')
      ->innerJoin('ci3.Company c41')
      ->addWhere('c41.status = ?',  $value);
      
      return $query;
   
  } 
 
   static public function  applySectorCityFilter($query, $value)
  {
    $rootAlias = $query->getRootAlias();
      $query->innerJoin($rootAlias.'.CompanyImage ci3')
      ->innerJoin('ci3.Company c41')
      ->innerJoin('c41.CompanyClassification ccl1')
       ->innerJoin('ccl1.Classification cl1')
       ->innerJoin('cl1.ClassificationSector csl1')
       ->innerJoin('csl1.Sector sl1')
       ->innerJoin('sl1.Translation stl1')
      ->addWhere('stl1.title = ?',  $value);
      
      return $query;
   
  } 
  */
  
  static public function applyCityIdFilter($query, $value)
  {
  	$rootAlias = $query->getRootAlias();
  	$query->addWhere('city_id = ?',  intval($value));
  
  	return $query;
  }
  
}