<?php
 
/**
 * FacebookReviewGame
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    getLokal
 * @subpackage model
 * @author     Get Lokal
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class FacebookReviewGame extends BaseFacebookReviewGame
{
    public function getCountUsers() {
        $query = Doctrine::getTable('FacebookReviewGameResult')
                ->createQuery('frgr')
                ->where('frgr.facebook_review_game_id = ?', $this->getId());

        $total = 0;
        foreach ($query->execute() as $result) {
            $total = $total + $result->getParam2();
        }

        return $total;

        /*return Doctrine::getTable('FacebookReviewGameUser')
                ->createQuery('fgru')
                ->where('fgru.facebook_review_game_id = ?', $this->getId())
                ->count();
         */
    }

    public function getUserResults($count) {
        $query = Doctrine::getTable('FacebookReviewGameResult')
                ->createQuery('frgr')
                ->where('frgr.facebook_review_game_id = ?', $this->getId());

        $resArr = array();
        foreach ($query->execute() as $result) {
            $resArr[$result->getParam1()] = number_format((($result->getParam2() / $count) * 100), 2);
        }

        return $resArr;
    }
}